<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Difusión - Listado de Eventos</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Custom Style -->
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Table specifics not general enough for styles.css yet */
        .table-view-container {
            margin-top: 1rem;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <header class="main-header glass-panel">
            <div class="logo-area">
                <h1>Difusión</h1>
                <p>Gestión de Eventos y Exposiciones</p>
            </div>
            <div class="actions">
                <a href="index.html" class="btn secondary">
                    <i data-lucide="calendar"></i> CALENDARIO
                </a>
                <button id="templateBtn" class="btn secondary" title="Descargar plantilla de ejemplo">
                    <i data-lucide="file-spreadsheet"></i> Plantilla
                </button>
                <button id="importBtn" class="btn secondary" title="Importar eventos desde Excel">
                    <i data-lucide="upload"></i> Importar
                </button>
                <input type="file" id="importFile" accept=".xlsx, .xls" style="display: none;">
                <button id="exportBtn" class="btn secondary">
                    <i data-lucide="download"></i> Excel
                </button>
                <button id="addEventBtn" class="btn primary">
                    <i data-lucide="plus"></i> Nuevo
                </button>
            </div>
        </header>

        <section id="alertsContainer" class="alerts-container">
            <div class="alerts-header">
                <i data-lucide="bell-ring"></i> Avisos y Plazos de Tareas
            </div>
            <div id="alertsList"></div>
        </section>

        <main class="page-content glass-panel">
            <div class="map-section">
                <div id="map"></div>
            </div>

            <div class="filters-bar">
                <div class="filter-group">
                    <label>Buscar por nombre / lugar</label>
                    <input type="text" id="searchInput" placeholder="Nombre, concello, lugar...">
                </div>
                <div class="filter-group">
                    <label>Filtrar por Mes</label>
                    <input type="text" id="monthFilter" placeholder="Ej: Enero 2024" list="monthSuggestions">
                    <datalist id="monthSuggestions"></datalist>
                </div>
                <div class="filter-actions" style="display: flex; gap: 0.5rem; align-items: flex-end;">
                    <button id="searchBtn" class="btn primary" title="Buscar">
                        <i data-lucide="arrow-right"></i>
                    </button>
                    <button id="resetFiltersBtn" class="icon-btn" title="Reiniciar filtros"
                        style="height: 42px; width: 42px;">
                        <i data-lucide="rotate-ccw"></i>
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="events-table">
                    <thead>
                        <tr>
                            <th id="sortDate" style="cursor: pointer;">Fecha <i data-lucide="arrow-up-down"></i></th>
                            <th id="sortTitle" style="cursor: pointer;">Evento <i data-lucide="arrow-up-down"></i></th>
                            <th id="sortLoc" style="cursor: pointer;">Ayuntamiento <i data-lucide="arrow-up-down"></i>
                            </th>
                            <th id="sortProvince" style="cursor: pointer;">Provincia <i data-lucide="arrow-up-down"></i>
                            </th>
                            <th>Horario</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="eventsTableBody">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modals are shared between pages visually, but need to be present or injected -->
    <!-- Modal: Add Event -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="addEventForm">
                <div class="form-group">
                    <label>Nombre del Evento</label>
                    <input type="text" name="title" required placeholder="Ej: Feria de Arte">
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Fecha Inicio (Opcional)</label>
                        <input type="date" name="start">
                    </div>
                    <div class="form-group">
                        <label>Fecha Fin (Opcional)</label>
                        <input type="date" name="end">
                    </div>
                </div>
                <div class="form-group">
                    <label>Horario</label>
                    <input type="text" name="schedule" placeholder="10:00 - 18:00">
                </div>
                <div class="form-group">
                    <label>Concello / Ayuntamiento</label>
                    <select id="locationSelect" name="municipality">
                        <option value="">-- Selecciona un Concello --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dirección Exacta / Sala / Local</label>
                    <input type="text" id="locationInput" name="location" placeholder="Calle, nº, pabellón..."
                        autocomplete="off">
                    <input type="hidden" id="latInput" name="lat">
                    <input type="hidden" id="lngInput" name="lng">
                    <input type="hidden" id="provinceInput" name="province">
                </div>
                <div class="form-group">
                    <label>Detalles / Notas</label>
                    <textarea name="details" placeholder="Notas adicionales..." style="min-height: 80px;"></textarea>
                </div>
                <button type="submit" class="btn primary full-width">Guardar Evento</button>
            </form>
        </div>
    </div>

    <!-- Modal: Edit Event -->
    <div id="editEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="editEventForm">
                <input type="hidden" name="id" id="editEventId">
                <div class="form-group">
                    <label>Nombre del Evento</label>
                    <input type="text" name="title" id="editTitle" required>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Fecha Inicio (Opcional)</label>
                        <input type="date" name="start" id="editStart">
                    </div>
                    <div class="form-group">
                        <label>Fecha Fin (Opcional)</label>
                        <input type="date" name="end" id="editEnd">
                    </div>
                </div>
                <div class="form-group">
                    <label>Horario</label>
                    <input type="text" name="schedule" id="editSchedule">
                </div>
                <div class="form-group">
                    <label>Concello / Ayuntamiento</label>
                    <select id="editLocationSelect" name="municipality">
                        <option value="">-- Selecciona un Concello --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dirección Exacta / Sala / Local</label>
                    <input type="text" id="editLocationInput" name="location" autocomplete="off">
                    <input type="hidden" id="editLatInput" name="lat">
                    <input type="hidden" id="editLngInput" name="lng">
                    <input type="hidden" id="editProvinceInput" name="province">
                </div>
                <div class="form-group">
                    <label>Detalles / Notas</label>
                    <textarea name="details" id="editDetails" style="min-height: 80px;"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button type="submit" class="btn primary" style="flex: 1;">Actualizar</button>
                    <button type="button" id="deleteEventBtn" class="btn secondary"
                        style="color: #ef4444; border-color: #fee2e2; background: #fff1f2;">Eliminar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Event Details -->
    <div id="eventDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detailTitle">Título del Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <div class="event-info">
                <p><i data-lucide="calendar"></i> <span id="detailDates"></span></p>
                <p><i data-lucide="clock"></i> <span id="detailSchedule"></span></p>
                <p><i data-lucide="map-pin"></i> <span id="detailLocation"></span></p>
            </div>

            <div class="checklist-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h4 style="margin: 0;">Tareas y Estado</h4>
                    <button id="editEventBtn_FromDetails" class="btn secondary btn-small"><i data-lucide="edit-3"></i>
                        EDITAR</button>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-info">
                        <span>Progreso</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="checklistProgress" class="progress-fill"></div>
                    </div>
                </div>
                <ul id="checklistItems" class="checklist">
                    <!-- Javascript will populate this -->
                </ul>
            </div>
        </div>
    </div>

    <script src="locations_data.js"></script>
    <script src="script.js"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>