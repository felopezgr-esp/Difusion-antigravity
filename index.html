<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Difusión - Calendario de Eventos</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <!-- Custom Style -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <header class="main-header glass-panel">
            <div class="logo-area">
                <h1>Difusión</h1>
                <p>Gestión de Eventos y Exposiciones</p>
            </div>
            <div class="actions">
                <a href="eventos.html" class="btn secondary">
                    <i data-lucide="list"></i> LISTADO
                </a>
                <button id="templateBtn" class="btn secondary" title="Descargar plantilla de ejemplo">
                    <i data-lucide="file-spreadsheet"></i> Plantilla
                </button>
                <button id="importBtn" class="btn secondary" title="Importar eventos desde Excel">
                    <i data-lucide="upload"></i> Importar
                </button>
                <input type="file" id="importFile" accept=".xlsx, .xls" style="display: none;">
                <button id="exportBtn" class="btn secondary">
                    <i data-lucide="download"></i> Excel
                </button>
                <button id="addEventBtn" class="btn primary">
                    <i data-lucide="plus"></i> Nuevo
                </button>
            </div>
        </header>

        <section id="alertsContainer" class="alerts-container">
            <div class="alerts-header">
                <i data-lucide="bell-ring"></i> Avisos y Plazos de Tareas
            </div>
            <div id="alertsList"></div>
        </section>

        <section id="undatedEventsContainer" class="undated-container glass-panel">
            <div class="undated-header">
                <i data-lucide="calendar-off"></i> Eventos sin Fecha Confirmada
            </div>
            <div id="undatedEventsList" class="undated-list">
                <!-- Javascript will populate this -->
            </div>
        </section>

        <main class="calendar-container glass-panel">
            <div class="calendar-header">
                <button id="prevMonth" class="icon-btn"><i data-lucide="chevron-left"></i></button>
                <h2 id="currentMonthYear">Cargando...</h2>
                <button id="nextMonth" class="icon-btn"><i data-lucide="chevron-right"></i></button>
            </div>
            <div class="calendar-grid-header">
                <div>Dom</div>
                <div>Lun</div>
                <div>Mar</div>
                <div>Mié</div>
                <div>Jue</div>
                <div>Vie</div>
                <div>Sáb</div>
            </div>
            <div id="calendarGrid" class="calendar-grid">
                <!-- Javascript will populate this -->
            </div>
        </main>
    </div>

    <!-- Modal: Add Event -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="addEventForm">
                <div class="form-group">
                    <label>Nombre del Evento</label>
                    <input type="text" name="title" required placeholder="Ej: Feria de Arte">
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Fecha Inicio (Opcional)</label>
                        <input type="date" name="start">
                    </div>
                    <div class="form-group">
                        <label>Fecha Fin (Opcional)</label>
                        <input type="date" name="end">
                    </div>
                </div>
                <div class="form-group">
                    <label>Horario</label>
                    <input type="text" name="schedule" placeholder="10:00 - 18:00">
                </div>
                <div class="form-group">
                    <label>Concello / Ayuntamiento</label>
                    <select id="locationSelect" name="municipality">
                        <option value="">-- Selecciona un Concello --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dirección Exacta / Sala / Local</label>
                    <input type="text" id="locationInput" name="location" placeholder="Calle, nº, pabellón..."
                        autocomplete="off">
                    <input type="hidden" id="latInput" name="lat">
                    <input type="hidden" id="lngInput" name="lng">
                    <input type="hidden" id="provinceInput" name="province">
                </div>
                <div class="form-group">
                    <label>Detalles / Notas</label>
                    <textarea name="details" placeholder="Notas adicionales..." style="min-height: 80px;"></textarea>
                </div>
                <button type="submit" class="btn primary full-width">Guardar Evento</button>
            </form>
        </div>
    </div>

    <!-- Modal: Edit Event -->
    <div id="editEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <form id="editEventForm">
                <input type="hidden" name="id" id="editEventId">
                <div class="form-group">
                    <label>Nombre del Evento</label>
                    <input type="text" name="title" id="editTitle" required>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Fecha Inicio (Opcional)</label>
                        <input type="date" name="start" id="editStart">
                    </div>
                    <div class="form-group">
                        <label>Fecha Fin (Opcional)</label>
                        <input type="date" name="end" id="editEnd">
                    </div>
                </div>
                <div class="form-group">
                    <label>Horario</label>
                    <input type="text" name="schedule" id="editSchedule">
                </div>
                <div class="form-group">
                    <label>Concello / Ayuntamiento</label>
                    <select id="editLocationSelect" name="municipality">
                        <option value="">-- Selecciona un Concello --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dirección Exacta / Sala / Local</label>
                    <input type="text" id="editLocationInput" name="location" autocomplete="off">
                    <input type="hidden" id="editLatInput" name="lat">
                    <input type="hidden" id="editLngInput" name="lng">
                    <input type="hidden" id="editProvinceInput" name="province">
                </div>
                <div class="form-group">
                    <label>Detalles / Notas</label>
                    <textarea name="details" id="editDetails" style="min-height: 80px;"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button type="submit" class="btn primary" style="flex: 1;">Actualizar</button>
                    <button type="button" id="deleteEventBtn" class="btn secondary"
                        style="color: #ef4444; border-color: #fee2e2; background: #fff1f2;">Eliminar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Event Details -->
    <div id="eventDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detailTitle">Título del Evento</h3>
                <button class="close-modal"><i data-lucide="x"></i></button>
            </div>
            <div class="event-info">
                <p><i data-lucide="calendar"></i> <span id="detailDates"></span></p>
                <p><i data-lucide="clock"></i> <span id="detailSchedule"></span></p>
                <p><i data-lucide="map-pin"></i> <span id="detailLocation"></span></p>
            </div>

            <div class="checklist-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h4 style="margin: 0;">Tareas y Estado</h4>
                    <button id="editEventBtn_FromDetails" class="btn secondary btn-small"><i data-lucide="edit-3"></i>
                        EDITAR</button>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-info">
                        <span>Progreso</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="checklistProgress" class="progress-fill"></div>
                    </div>
                </div>
                <ul id="checklistItems" class="checklist">
                    <!-- Javascript will populate this -->
                </ul>
            </div>
        </div>
    </div>

    <script src="locations_data.js"></script>
    <script src="script.js"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>